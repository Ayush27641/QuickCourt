generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ROLE_USER
  ROLE_FACILITY_OWNER
  ROLE_ADMIN
}

model UserRegistrationsModel {
  email     String  @id
  password  String
  fullName  String
  avatarUrl String?
  role      Role
  verified  Boolean?

  @@map("users")
}

model FacilityOwnerProfile {
  email      String @id
  facilityIds Int[]  @default([])
}

model Venue {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  address     String?
  isVerified  Boolean  @default(false)
  photoUrls   String[] @default([])
  amenities   String[] @default([])
  rating      Int      @default(0)
  ownerMail   String?
  sportIds    Int[]    @default([]) @map("SportIds")

  @@map("venue")
}

model Sport {
  id            Int      @id @default(autoincrement())
  name          String
  type          String?
  pricePerHour  Decimal? @db.Decimal(12, 2)
  operatingHours String?

  averageRating Float @default(0.0)
  venueId       Int?
  commentIds    Int[] @default([])

  @@map("sport")
}

model Comment {
  id        Int      @id @default(autoincrement())
  text      String   @db.Text
  upvotes   Int      @default(0)
  downvotes Int      @default(0)

  userEmail String?  @map("UserEmail")
  sportId   Int?
  rating    Int?
  createdAt DateTime @default(now())

  @@map("comment")
}

model Booking {
  id                Int      @id @default(autoincrement())
  sportId            Int?
  venueId            Int?
  facilityOwnerEmail String?
  userEmail          String?

  status     String   @default("CONFIRMED")
  totalPrice Decimal  @default(0) @db.Decimal(12, 2)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now())
  version    Int?

  slots BookingSlot[]

  @@map("booking")
}

model BookingSlot {
  id            Int      @id @default(autoincrement())
  bookingId     Int
  startDateTime DateTime
  endDateTime   DateTime
  price         Decimal? @db.Decimal(12, 2)

  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("booking_slots")
}

model FacilityEarnings {
  facilityOwnerEmail String @id
  version            Int?

  monthlyEarnings MonthEarning[]

  @@map("facility_earnings")
}

model MonthEarning {
  id                Int      @id @default(autoincrement())
  facilityOwnerEmail String
  month             Int?
  earning           Decimal  @default(0) @db.Decimal(12, 2)
  recordedAt        DateTime @default(now())

  facilityEarnings FacilityEarnings @relation(fields: [facilityOwnerEmail], references: [facilityOwnerEmail], onDelete: Cascade)

  @@map("facility_monthly_earnings")
}

model RefundModel {
  id        Int     @id @default(autoincrement())
  userEmail String?
  ownerMail String?
  amount    String?
  bookingId Int?
  status    String?

  @@map("refund_model")
}

model Game {
  id                    Int      @id @default(autoincrement())
  gameName              String?
  location              String?
  timeDate              DateTime?
  venue                 String?
  playersRequired       Int      @default(0)
  listOfUserEmailJoined String[] @default([])

  @@map("game")
}

model UserGameProfile {
  userEmail       String @id
  idsOfGamesJoined Int[]  @default([])

  @@map("user_game_profile")
}

model Room {
  id      Int    @id @default(autoincrement())
  roomId  String @unique
  user1   String?
  user2   String?

  messages Message[]

  @@map("room")
}

model Message {
  id        Int      @id @default(autoincrement())
  roomDbId  Int
  sender    String?
  content   String?
  timeStamp DateTime @default(now())

  room Room @relation(fields: [roomDbId], references: [id], onDelete: Cascade)

  @@map("message")
}
